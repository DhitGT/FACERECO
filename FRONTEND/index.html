<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Absensi dengan Face Recognition</title>
    <script defer src="face-api.min.js"></script>
    <script defer src="script.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body class="text-white font-sans">
    <div class="max-w-[90VW] p-4">
      <div
        class="flex justify-between items-center bg-gradient-to-r from-purple-500 to-blue-500 p-4 rounded-t-lg"
      >
        <i class="fas fa-circle-notch text-4xl"> </i>
        <h1 class="text-xl font-bold">Sistem Absensi Face Recognition</h1>
        <i class="fas fa-circle-notch text-4xl"> </i>
      </div>
      <div class="p-4 rounded-b-lg">
        <div class="flex gap-4">
          <div
            style="background-color: rgba(216, 25, 210, 0.11)"
            class="bg-white backdrop-blur max-h-fit rounded-lg p-4"
          >
            <div
              id="container-vidio"
              style="position: relative; width: 500px; height: 380px"
            >
              <video id="video" width="500" height="380" autoplay></video>
            </div>
            <!-- <img
              alt="Landscape image"
              class="w-full rounded-lg"
              height="200"
              src="https://storage.googleapis.com/a1aa/image/LKtIWJDaSzonP1Qp2y0wSLeiIBlFMPLRl4eu8QYqqmf629fPB.jpg"
              width="300"
            /> -->
          </div>
          <div
            style="background-color: rgba(216, 25, 210, 0.11)"
            class="justify-start backdrop-blur w-full rounded-lg p-4 flex flex-col items-center"
          >
            <div class="flex items-center space-x-2">
              <i class="fas fa-clock text-2xl"> </i>
              <span class="text-4xl font-bold text-red-600"> 10:00 </span>
            </div>
            <div class="mt-4 flex items-center space-x-2">
              <i class="fas fa-calendar-alt text-2xl"> </i>
              <div>
                <p class="text-xl font-bold">Senin</p>
                <p>19 Desember 2023</p>
              </div>
            </div>
          </div>
        </div>
        <div
          style="
            background-color: rgba(216, 25, 210, 0.11);
            backdrop-filter: blur(10px);
          "
          class="mt-4 p-2 rounded-lg"
        >
          <h2 class="text-xl font-bold mb-4 text-center">Guru Pengajar</h2>
          <div class="flex justify-around">
            <div class="text-center">
              <img
                alt="Teacher image"
                style="border: 2px solid white"
                class="w-24 h-24 rounded-full border-1 border-white mx-auto"
                height="100"
                src="https://storage.googleapis.com/a1aa/image/tmEJcX0TN6YeZyAX1zQCE2Vmkm9JE77PBDD43IdHztovdffnA.jpg"
                width="100"
              />
              <p class="mt-2">nama</p>
            </div>
            <div class="text-center">
              <img
                alt="Teacher image"
                style="border: 2px solid white"
                class="w-24 h-24 rounded-full border-1 border-white mx-auto"
                height="100"
                src="https://storage.googleapis.com/a1aa/image/tmEJcX0TN6YeZyAX1zQCE2Vmkm9JE77PBDD43IdHztovdffnA.jpg"
                width="100"
              />
              <p class="mt-2">nama</p>
            </div>
            <div class="text-center">
              <img
                alt="Teacher image"
                style="border: 2px solid white"
                class="w-24 h-24 rounded-full border-1 border-white mx-auto"
                height="100"
                src="https://storage.googleapis.com/a1aa/image/tmEJcX0TN6YeZyAX1zQCE2Vmkm9JE77PBDD43IdHztovdffnA.jpg"
                width="100"
              />
              <p class="mt-2">nama</p>
            </div>
            <div class="text-center">
              <img
                alt="Teacher image"
                style="border: 2px solid white"
                class="w-24 h-24 rounded-full border-1 border-white mx-auto"
                height="100"
                src="https://storage.googleapis.com/a1aa/image/tmEJcX0TN6YeZyAX1zQCE2Vmkm9JE77PBDD43IdHztovdffnA.jpg"
                width="100"
              />
              <p class="mt-2">nama</p>
            </div>
          </div>
        </div>
        <div class="flex my-6 flex flex-col gap-6">
          <a
            href="#"
            class="flex flex-col items-center  min-h-64 bg-white border border-gray-200 rounded-lg shadow md:flex-row hover:bg-gray-100"
          >
            
            <div class="flex flex-col justify-between p-4 leading-normal">
              <h5
                class="mb-2 text-2xl font-bold tracking-tight text-gray-900 "
              >
                Noteworthy technology acquisitions 2021
              </h5>
              <p class="mb-3 font-normal text-gray-700 ">
                Here are the biggest enterprise technology acquisitions of 2021
                so far, in reverse chronological order.
              </p>
            </div>
            <img
              class="object-cover w-full rounded-t-lg h-full  md:w-64 md:rounded-none md:rounded-s-lg"
              src="https://placehold.co/400"
              alt=""
            />
          </a>
          <a
            href="#"
            class="flex flex-col items-center  min-h-64 bg-white border border-gray-200 rounded-lg shadow md:flex-row hover:bg-gray-100"
          >
            
            <div class="flex flex-col justify-between p-4 leading-normal">
              <h5
                class="mb-2 text-2xl font-bold tracking-tight text-gray-900 "
              >
                Noteworthy technology acquisitions 2021
              </h5>
              <p class="mb-3 font-normal text-gray-700 ">
                Here are the biggest enterprise technology acquisitions of 2021
                so far, in reverse chronological order.
              </p>
            </div>
            <img
              class="object-cover w-full rounded-t-lg h-full  md:w-64 md:rounded-none md:rounded-s-lg"
              src="https://placehold.co/400"
              alt=""
            />
          </a>
        </div>
        <div class="mt-4 bg-gray-800 p-4 rounded-lg text-center">
          <h2 class="text-2xl font-bold">REKAYASA PERANGKAT LUNAK</h2>
        </div>
        <div class="mt-4 text-center">
          <p>Copyright RPL</p>
        </div>
      </div>
    </div>

    <!-- Script -->
    <script>
      let sen = "";

      document.getElementById("infoAbsen").textContent = infoAbsen;

      document.getElementById("close-button").addEventListener("click", () => {
        popup.style.display = "none";
        overlay.style.display = "none";
      });

      const attendanceEndpoint = "http://localhost:8000/dashboard"; // Replace with your API endpoint

      // document.getElementById("start-button").addEventListener("click", () => {
      //   // Simulate validation of the person in the database
      //   const detectedPerson = validatePerson(database, "67890"); // ID of the detected person
      //   if (detectedPerson) {
      //     const currentTime = getCurrentTime();
      //     showPopup(
      //       `Selamat datang, ${detectedPerson.name}. Anda absen di jam ${currentTime}`
      //     );

      //     // Post attendance data
      //     postAttendance("dheep");
      //   }
      // });

      function validatePerson(db, detectedId) {
        for (let person in db) {
          if (db[person].id === detectedId) {
            return db[person];
          }
        }
        return null;
      }

      function showPopup(message) {
        const popup = document.getElementById("popup");
        const overlay = document.getElementById("popup-overlay");
        const popupMessage = document.getElementById("popup-message");

        popupMessage.textContent = message;
        popup.classList.add("show");
        overlay.classList.add("show");

        // Menutup popup secara otomatis setelah 5 detik
        setTimeout(() => {
          closePopup();
        }, 5000);
      }

      function closePopup() {
        const popup = document.getElementById("popup");
        const overlay = document.getElementById("popup-overlay");

        popup.classList.remove("show");
        overlay.classList.remove("show");
      }

      // Event listener untuk tombol tutup
      document
        .getElementById("close-button")
        .addEventListener("click", closePopup);

      async function postAttendance(name, flag) {
        console.log("info absen : ", infoAbsen);
        console.log("flag : ", flag);

        try {
          await fetch("http://127.0.0.1:8000/storeAbsen", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Accept: "application/json",
            },
            body: JSON.stringify({
              name: name,
              flag: flag,
            }),
          })
            .then((response) => response.json()) // Ensure to handle the JSON response
            .then((data) => {
              console.log("Success:", data);
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        } catch (error) {
          console.log("rorwr", error);
        }
      }

      function updateAttendanceStatus() {
        const now = new Date();
        const currentHour = now.getHours();
        const currentMinute = now.getMinutes();

        console.log("JAMM : ", currentHour);

        // Logic for setting attendance status
        if (currentHour >= 0 && currentHour < 12) {
          infoAbsen = "Absen Masuk";
        } else if (currentHour >= 12) {
          infoAbsen = "Absen Keluar";
        }

        // Update the status on the UI
        document.getElementById("infoAbsen").textContent = infoAbsen;
      }

      // function updateClock() {
      //   const now = new Date();

      //   // Format tanggal (contoh: Sabtu, 28 Desember 2024)
      //   const options = {
      //     weekday: "long",
      //     year: "numeric",
      //     month: "long",
      //     day: "numeric",
      //   };
      //   const formattedDate = now.toLocaleDateString("id-ID", options);

      //   // Format waktu (contoh: 14:45:30)
      //   const formattedTime = now.toLocaleTimeString("id-ID", {
      //     hour: "2-digit",
      //     minute: "2-digit",
      //     second: "2-digit",
      //   });

      //   // Debugging - Tampilkan hasil di console
      //   console.log("Tanggal: ", formattedDate);
      //   console.log("Waktu: ", formattedTime);

      //   // Update elemen HTML
      //   document.getElementById("date").innerText = formattedDate;
      //   document.getElementById("time").innerText = formattedTime;
      // }

      function getCurrentTime() {
        const now = new Date();
        return now.toLocaleTimeString("id-ID", {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        });
      }

      // function updateClock() {
      //   const clockElement = document.getElementById("clock");
      //   const now = new Date();
      //   clockElement.textContent = `Jam: ${now.toLocaleTimeString("en-US", {
      //     hour: "2-digit",
      //     minute: "2-digit",
      //     second: "2-digit",
      //   })}`;
      // }
      function updateJam() {
        // console.log("f update jam")
        const now = new Date();

        // Format tanggal (contoh: Sabtu, 28 Desember 2024)
        const options = {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        };
        const formattedDate = now.toLocaleDateString("id-ID", options);

        // Format waktu (contoh: 14:45:30)
        const formattedTime = now.toLocaleTimeString("id-ID", {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        });

        // Debugging - Menampilkan di konsol
        // console.log("Tanggal: ", formattedDate);
        // console.log("Waktu: ", formattedTime);

        // Update elemen HTML
        document.getElementById("date").textContent = formattedDate;
        document.getElementById("clock").textContent = formattedTime;
      }
      setInterval(updateJam, 1000);
      updateJam(); // Initial call

      updateAttendanceStatus();
      setInterval(updateAttendanceStatus, 60000); // Update status every minute
    </script>
  </body>
</html>
